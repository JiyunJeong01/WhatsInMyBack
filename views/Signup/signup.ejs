<!DOCTYPE html>
<html>
<head>
    <title>회원가입</title>
    <style>
        body {
            background-color: white;
            font-family: Arial, sans-serif;
        }
        .container {
            width: 300px;
            margin: 0 auto;
        }
        .title {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
        }
        .input-field {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            box-sizing: border-box;
            border: none;
            border-radius: 5px;
            box-shadow: 0px 0px 15px 0px rgba(0,0,0,0.2);
        }
        .dropdown {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            box-sizing: border-box;
            border: none;
            border-radius: 5px;
            box-shadow: 0px 0px 15px 0px rgba(0,0,0,0.2);
            cursor: pointer;
        }
        .signup-button {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            box-sizing: border-box;
            border: none;
            border-radius: 5px;
            background-color: black;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }
        .signup-button:disabled {
            background-color: grey;
            cursor: not-allowed;
        }
        .tag {
            display: inline-block;
            padding: 5px 10px;
            margin: 5px;
            border: 1px solid black;
            border-radius: 5px;
            cursor: pointer;
        }
        .tag.selected {
            background-color: gray;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="title">회원가입</div>
        <form id="signup-form">
            <input type="text" class="input-field" id="email" name="email" placeholder="이메일">
            <input type="password" class="input-field" id="password" placeholder="비밀번호">
            <input type="password" class="input-field" id="password-confirm" placeholder="비밀번호 확인">
            <input type="text" class="input-field" id="username" name="username" placeholder="이름">
            <input type="text" class="input-field" id="nickname" name="nickname" placeholder="닉네임">
            <input type="text" class="input-field" id="job" name="job" placeholder="직업">
            <select id="gender" class="dropdown">
                <option value="" disabled selected>성별</option>
                <option value="남">남</option>
                <option value="여">여</option>
            </select>
            <select id="birth-year" class="dropdown">
                <option value="" disabled selected>출생연도</option>
            </select>
            <div class="container">
                <div class="title">관심 테마 설정</div>
                <div id="theme_list">
                    <% themes.forEach(function(theme) { %>
                        <span class="tag" data-theme-id="<%= theme.theme_id %>"><%= theme.theme_name %></span>
                    <% }); %>
                </div>
                <button type="submit" class="signup-button" id="signup-button" disabled>가입하기</button>
            </div>
        </form>
        <script>
            // 출생연도 드롭다운 메뉴에 1980년부터 2024년까지 추가
            const birthYearSelect = document.getElementById('birth-year');
            const currentYear = new Date().getFullYear();
            for (let year = 1980; year <= currentYear; year++) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                birthYearSelect.appendChild(option);
            }

            // 테마 클릭 이벤트
            document.querySelectorAll('.tag').forEach(tag => {
                tag.addEventListener('click', () => {
                    tag.classList.toggle('selected');
                });
            });

            // 회원가입 버튼 활성화/비활성화
            const form = document.getElementById('signup-form');
            const signupButton = document.getElementById('signup-button');
            const email = document.getElementById('email');
            const password = document.getElementById('password');
            const passwordConfirm = document.getElementById('password-confirm');
            const username = document.getElementById('username');
            const nickname = document.getElementById('nickname');
            const job = document.getElementById('job');
            const gender = document.getElementById('gender');
            const birthYear = document.getElementById('birth-year');

            // 폼 필드에 입력할 때마다 실행
            form.addEventListener('input', () => {
                const allFieldsFilled = email.value && password.value && passwordConfirm.value &&
                                        username.value && nickname.value && job.value && gender.value &&
                                        birthYear.value;
                const passwordsMatch = password.value === passwordConfirm.value;

                signupButton.disabled = !(allFieldsFilled && passwordsMatch);
            });

            // 회원가입 버튼을 눌렀을 때 실행
            form.addEventListener('submit', (e) => {
                e.preventDefault();

                if (signupButton.disabled) return;

                const age = currentYear - birthYear.value;
                const selectedThemes = Array.from(document.querySelectorAll('.tag.selected'))
                                        .map(tag => tag.getAttribute('data-theme-id'));

                const userData = {
                    email: email.value,
                    password: password.value,
                    username: username.value,
                    nickname: nickname.value,
                    job: job.value,
                    gender: gender.value,
                    age: age,
                    themes: selectedThemes
                };

                // 서버로 데이터 전송하는 부분
                fetch('/signup', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(userData)
                }).then(response => {
                    if (response.ok) {
                        alert('회원가입이 완료되었습니다.');
                        window.location.href = '/';
                    } else {
                        return response.json().then(error => {
                            alert('회원가입에 실패했습니다: ' + error.message);
                        });
                    }
                }).catch(error => {
                    console.error('Error:', error);
                    alert('회원가입에 실패했습니다!!');
                });
            });

        </script>
    </div>
</body>
</html>
